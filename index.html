<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ONZEN TEST</title>
<link href="https://fonts.googleapis.com/css?family=Sriracha" rel="stylesheet" type='text/css'>


    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsenui.css">
    <link rel="stylesheet" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
    <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery/2.0.0/jquery.min.js"></script>
    <script src="dist/jquery.cropit.js"></script>
    <script src="dist/jquery-ui.js"></script>
    <script src="dist/jquery.ui.touch-punch.min.js"></script>
    <link rel="stylesheet" href="dist/css/app.css">

</head>
<body>

<ons-navigator id="myNavigator" page="page1.html"></ons-navigator>

<ons-template id="page1.html">
    <ons-page id="page1">

        <ons-toolbar >

            <div class="center" style="text-align: center">เลือกรูป</div>
            <div class="right">

                <ons-toolbar-button id="next-page2"  disabled >
                    Next &nbsp<i class="zmdi zmdi zmdi-play zmdi-hc-lg"></i>
                </ons-toolbar-button>
            </div>

        </ons-toolbar>

        <div class="image-editor">
            <ons-row >

                <label class="fileContainer">
                    <input type="file" class="cropit-image-input"/>
                </label>

            </ons-row>
            <ons-row>
                <!--<ons-col width="10px">   </ons-col>-->

                <div class="cropit-preview"></div>

            </ons-row>


            <table >
                <tr>
                    <td><ons-icon size="15px" icon="md-flower-alt" ></ons-icon></td>
                    <td><input type="range" class="cropit-image-zoom-input custom"></td>
                    <td><ons-icon size="30px" icon="md-flower-alt" ></ons-icon></td>
                    <td>&nbsp;</td>
                    <td><ons-button class="rotate-ccw" ><ons-icon icon="md-rotate-left"></ons-icon></ons-button></td>
                    <td><ons-button class="rotate-cw" ><ons-icon icon="md-rotate-right"></ons-icon></ons-button></td>
                </tr>
            </table>
        </div>

    </ons-page>
</ons-template>
<ons-template id="page2.html">
    <ons-page id="page2">
        <ons-toolbar>
            <div class="left"><ons-back-button>Back</ons-back-button></div>
            <div class="center" style="text-align: center">ใส่ข้อความ</div>
            <div class="right">
            <ons-toolbar-button id="next-page3" >
                Next &nbsp<i class="zmdi zmdi zmdi-play zmdi-hc-lg"></i>
            </ons-toolbar-button>
            </div>
        </ons-toolbar>
<!--        <p style="text-align: center; margin-top: 30px;">

        <table>
            <tr style="margin-top: 35px;">
            <td>ข้อความ 1: </td>
            <td>
        <ons-input id="yourtext0" modifier="underbar" placeholder="ใส่ข้อความตรงนี้" ></ons-input>
            </td>
            </tr>
            <tr style="margin-top: 35px;">
                <td>ข้อความ 2: </td>
                <td>
        <ons-input id="yourtext1" modifier="underbar" placeholder="ใส่ข้อความตรงนี้" ></ons-input>
                </td>
            </tr>
            <tr style="margin-top: 35px;">
                <td>ข้อความ 3:</td>
                <td>
        <ons-input id="yourtext2" modifier="underbar" placeholder="ใส่ข้อความตรงนี้" ></ons-input>
                </td>
            </tr>
            <td>ข้อความ 4:</td>
       <td>
        <ons-input id="yourtext3" modifier="underbar" placeholder="ใส่ข้อความตรงนี้" ></ons-input>
       </td>
        </tr>
        </table> -->


        <ons-row style="height:60px">
            <ons-col width="30%" vertical-align="center"> ข้อความ 1: </ons-col>
            <ons-col vertical-align="center"><ons-input id="yourtext0" modifier="underbar" placeholder="ใส่ข้อความตรงนี้" ></ons-input></ons-col>
        </ons-row>
        <ons-row style="height:60px">
            <ons-col width="30%" vertical-align="center"> ข้อความ 2: </ons-col>
            <ons-col vertical-align="center"><ons-input id="yourtext1" modifier="underbar" placeholder="ใส่ข้อความตรงนี้" ></ons-input></ons-col>
        </ons-row>
        <ons-row style="height:60px">
            <ons-col width="30%" vertical-align="center"> ข้อความ 3: </ons-col>
            <ons-col vertical-align="center"><ons-input id="yourtext2"  placeholder="ใส่ข้อความตรงนี้" ></ons-input></ons-col>
        </ons-row>
        <ons-row style="height:60px">
            <ons-col width="30%" vertical-align="center"> ข้อความ 4: </ons-col>
            <ons-col vertical-align="center"><ons-input id="yourtext3" placeholder="ใส่ข้อความตรงนี้" > </ons-input></ons-col>
        </ons-row>

    </ons-page>
</ons-template>
<ons-template id="page3.html">
    <ons-page id="page3">
        <ons-toolbar>
            <div class="left"><ons-back-button>Back</ons-back-button></div>
            <div class="center" style="text-align: center">เลือกสี</div>
            <div class="right">
            <ons-toolbar-button id="next-page4" >
                Next &nbsp<i class="zmdi zmdi zmdi-play zmdi-hc-lg"></i>
            </ons-toolbar-button>
            </div>
        </ons-toolbar>
        <ons-row>
        <ons-col>
        <canvas id="canvasText0" width="140" height="100" ></canvas>
        </ons-col>
            <ons-col width="24%">
                <ons-list modifier="material">
                    <ons-list-header>ขนาด</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-size0" onchange="sizeSelects(event,'0')">
                            <option value="30px">เล็ก </option>
                            <option value="40px" selected>กลาง</option>
                            <option value="50px">ใหญ่</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="20%">
                <ons-list modifier="material">
                    <ons-list-header>สี</ons-list-header>
                    <ons-list-item tappable>
                <ons-select id="choose-color0" onchange="colorSelects(event,'0')">
                    <option value="red" ><div style="color: red">แดง</div></option>
                    <option value="green"><div style="color: green">เขียว</div></option>
                    <option value="blue"><div style="color: blue">น้ำเงิน</div></option>
                </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="16%">
                <ons-list modifier="material">
                    <ons-list-header>ขอบ</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-stroke0" onchange="strokeSelects(event,'0')">
                            <option value="black">ดำ</option>
                            <option value="white">ขาว</option>
                            <option value="none">ไม่มี</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>

            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col>
                <canvas id="canvasText1" width="140" height="100" ></canvas>
            </ons-col>
            <ons-col width="24%">
                <ons-list modifier="material">
                    <ons-list-header>ขนาด</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-size1" onchange="sizeSelects(event,'1')">
                            <option value="30px">เล็ก </option>
                            <option value="40px" selected>กลาง</option>
                            <option value="50px">ใหญ่</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="20%">
                <ons-list modifier="material">
                    <ons-list-header>สี</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-color1" onchange="colorSelects(event,'1')">
                            <option value="red" ><div style="color: red">แดง</div></option>
                            <option value="green"><div style="color: green">เขียว</div></option>
                            <option value="blue"><div style="color: blue">น้ำเงิน</div></option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="16%">
                <ons-list modifier="material">
                    <ons-list-header>ขอบ</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-stroke1" onchange="strokeSelects(event,'1')">
                            <option value="black">ดำ</option>
                            <option value="white">ขาว</option>
                            <option value="none">ไม่มี</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>

            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col>
                <canvas id="canvasText2" width="140" height="100" ></canvas>
            </ons-col>
            <ons-col width="24%">
                <ons-list modifier="material">
                    <ons-list-header>ขนาด</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-size2" onchange="sizeSelects(event,'2')">
                            <option value="30px">เล็ก </option>
                            <option value="40px" selected>กลาง</option>
                            <option value="50px">ใหญ่</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="20%">
                <ons-list modifier="material">
                    <ons-list-header>สี</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-color2" onchange="colorSelects(event,'2')">
                            <option value="red" ><div style="color: red">แดง</div></option>
                            <option value="green"><div style="color: green">เขียว</div></option>
                            <option value="blue"><div style="color: blue">น้ำเงิน</div></option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="16%">
                <ons-list modifier="material">
                    <ons-list-header>ขอบ</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-stroke2" onchange="strokeSelects(event,'2')">
                            <option value="black">ดำ</option>
                            <option value="white">ขาว</option>
                            <option value="none">ไม่มี</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>

            </ons-col>
        </ons-row>
        <ons-row>
            <ons-col>
                <canvas id="canvasText3" width="140" height="100" ></canvas>
            </ons-col>
            <ons-col width="24%">
                <ons-list modifier="material">
                    <ons-list-header>ขนาด</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-size3" onchange="sizeSelects(event,'3')">
                            <option value="30px">เล็ก </option>
                            <option value="40px" selected>กลาง</option>
                            <option value="50px">ใหญ่</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="20%">
                <ons-list modifier="material">
                    <ons-list-header>สี</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-color3" onchange="colorSelects(event,'3')">
                            <option value="red" ><div style="color: red">แดง</div></option>
                            <option value="green"><div style="color: green">เขียว</div></option>
                            <option value="blue"><div style="color: blue">น้ำเงิน</div></option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>
            </ons-col>
            <ons-col width="16%">
                <ons-list modifier="material">
                    <ons-list-header>ขอบ</ons-list-header>
                    <ons-list-item tappable>
                        <ons-select id="choose-stroke3" onchange="strokeSelects(event,'3')">
                            <option value="black">ดำ</option>
                            <option value="white">ขาว</option>
                            <option value="none">ไม่มี</option>
                        </ons-select>
                    </ons-list-item>
                </ons-list>

            </ons-col>
        </ons-row>
    </ons-page>
</ons-template>
<ons-template id="page4.html">
    <ons-page id="page4">

        <ons-toolbar>
            <div class="left"><ons-back-button>Back</ons-back-button></div>
            <div class="center" style="text-align: center">เลือกตำแหน่ง</div>
            <div class="right">
            <ons-toolbar-button id="next-page5" >
                Next &nbsp<i class="zmdi zmdi zmdi-play zmdi-hc-lg"></i>
            </ons-toolbar-button>
                </div>
        </ons-toolbar>

        <!--<div id="dropThis">-->
        <canvas id="cavasPIC" width="370" height="320" ></canvas>
        <!--</div>-->
        <ons-gesture-detector>
            <!--<div id="dragThis">-->
            <canvas id="txtCanvas0" class="draggable" width="140" height="100"  style="position:absolute; top:0px; left:0px;"></canvas>
            <canvas id="txtCanvas1" class="draggable" width="140" height="100"  style="position:absolute; top:0px; left:230px;"></canvas>
            <canvas id="txtCanvas2" class="draggable" width="140" height="100"  style="position:absolute; top:220px; left:0px;"></canvas>
            <canvas id="txtCanvas3" class="draggable" width="140" height="100"  style="position:absolute; top:220px; left:230px;"></canvas>
            <!--</div>-->
        </ons-gesture-detector>
    </ons-page>
</ons-template>
<ons-template id="page5.html">
    <ons-page id="page5">
        <ons-toolbar>
            <div class="left"><ons-back-button>Back</ons-back-button></div>
            <div class="center"></div>
        </ons-toolbar>
        <canvas id="canvasPV" width="370" height="320" ></canvas>
    </ons-page>
</ons-template>
<script>
    //$(document.body).css('overflow-y', 'hidden');
    var posX =0,posY=0;
    var imageData,c,context_can,image;
    var txtColor = ['red','red','red','red'];
    var borderColor =['black','black','black','black'];
    var txtSize = ['40px','40px','40px','40px'];
    var no_border = false;
    var txt =['','','',''];

    function setBorderCanvas(canvasName,color){
        let canvas =document.getElementById(canvasName);
        canvas.style.borderColor =color;
    }
    function clearCanvas(canvasName){
        let canvas =document.getElementById(canvasName);
        let ctx = canvas.getContext("2d");
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    function drawText(wordIng,canvasName,textColor,strokeColor='black',fontSize='40px',fontName='Sriracha',xPos='0',yPos='0'){
        let canvas =document.getElementById(canvasName);

        if ((canvasName.substring(0, canvasName.length - 1) === 'canvasText')&&(strokeColor=== 'white')){
            canvas.style.background ='black';
            //canvas.style.borderColor ='red';
        } else if (strokeColor ==='black'){
            canvas.style.background='transparent';
            //canvas.style.borderColor ='red';
        } else { // none sure
            canvas.style.backgroud ='transparent';
            strokeColor =textColor;
        }
        let ctx = canvas.getContext("2d");
        ctx.textAlign = "left";
        ctx.textBaseline = "top";
        ctx.font = fontSize + ' '+ fontName;
        ctx.fillStyle = textColor;
        ctx.strokeStyle = strokeColor;
        if ((strokeColor ==='black')&& (fontSize==='40px'||(fontSize==='50px'))) {
            ctx.lineWidth = 2;
        } else {
            ctx.lineWidth = 1;
        }
        ctx.fillText(wordIng, xPos, yPos);
        ctx.strokeText(wordIng, xPos, yPos);
        ctx.fill();
        ctx.stroke();
    }
    function colorSelects(event,num) {
        txtColor[parseInt(num)] = event.target.value;
        clearCanvas("canvasText"+num);
        drawText(txt[parseInt(num)],"canvasText"+num,txtColor[parseInt(num)],borderColor[parseInt(num)],txtSize[parseInt(num)],"Sriracha",0,0);
    }
    function sizeSelects(event,num) {
        txtSize[parseInt(num)] = event.target.value;
        clearCanvas("canvasText"+num);
        drawText(txt[parseInt(num)],"canvasText"+num,txtColor[parseInt(num)],borderColor[parseInt(num)],txtSize[parseInt(num)],"Sriracha",0,0);
    }
    function strokeSelects(event,num) {
        if (event.target.value==='none'){
            borderColor[parseInt(num)] = txtColor[parseInt(num)];
            no_border = true; } // No border
        else {borderColor[parseInt(num)] = event.target.value;}
        clearCanvas("canvasText"+num);
        drawText(txt[parseInt(num)],"canvasText"+num,txtColor[parseInt(num)],borderColor[parseInt(num)],txtSize[parseInt(num)],"Sriracha",0,0);
    }
    function page3draw() {
        for (num = 0; num < txtColor.length; num++) {
            clearCanvas("canvasText"+num.toString());
            console.log("draw");
            drawText(txt[num.toString()], "canvasText"+num.toString(), txtColor[num], borderColor[num], txtSize[num]);
        }
    }
    document.addEventListener("show",function(e){
        if(e.target.id == 'page4'){

            fn.enableGD();
        } else if (e.target.id == 'page3'){ // make font show correct

          page3draw();
           /* clearCanvas("canvasText0");
            drawText(txt[0],"canvasText0",txtColor[parseInt(num)],borderColor[parseInt(num)],txtSize[parseInt(num)],"Sriracha",0,0);
*/
        }
    });
    var margin_top = $(".toolbar").css("height");
    window.fn = {};
//    fn.vtop = parseInt(margin_top);
    fn.vtop = 0;
    fn.vleft = 0;
    window.fn.enableGD = function(){

        var dragItems = document.querySelectorAll('.draggable');
        for (var i = 0; i < dragItems.length; i++) {
            dragItems[i].addEventListener('dragstart', function(e) {
                fn.vtop = parseInt(e.target.style.top || 0,10);
                fn.vleft = parseInt(e.target.style.left || 0,10);

            });
            dragItems[i].addEventListener('drag', function(e) {
                e.target.style.top = parseInt(fn.vtop + e.gesture.deltaY) + 'px';

                e.target.style.left = parseInt(fn.vleft + e.gesture.deltaX) + 'px';

                //document.getElementById('status').value = "Dragging";
                //document.getElementById('xdel').value = e.gesture.deltaX;
                //document.getElementById('ydel').value = e.gesture.deltaY;
                //document.getElementById('xpos').value = e.target.style.left;
                //document.getElementById('ypos').value = e.target.style.top;
            });
            dragItems[i].addEventListener('dragend', function(e) {
                // THIS EVENT IS NOT REQUIRED UNLESS YOU ARE DETECTING DROP
                fn.vtop = parseInt(e.target.style.top || 0,10);
                fn.vleft = parseInt(e.target.style.left || 0,10);


                console.log("x : "+fn.vleft);
                console.log("y : "+fn.vtop);


                posX =  parseInt(fn.vleft);
                posY =  parseInt(fn.vtop);

            });
        }
    }
    document.addEventListener('init', function(event) {
        var page = event.target;

        if (page.id === 'page1') {
            $('.image-editor').cropit({
                smallImage: 'allow',
                initialZoom: 'min', // 'image'
                minZoom: 'fill', // 'fit'
                freeMove :true,
                imageBackground: true,
                onImageError: function(e) {
                    ons.notification.alert(e.message);
                },
                onImageLoaded: function(ev){
                    $('#next-page2').attr('disabled', false);  // make Next button Enable
                }
            });
            // $('.image-editor').cropit('previewSize', { width: 370, height: 320 });
            $('.image-editor').cropit();

            $('.rotate-cw').click(function() {
                $('.image-editor').cropit('rotateCW');
            });
            $('.rotate-ccw').click(function() {
                $('.image-editor').cropit('rotateCCW');
            });
            page.querySelector('#next-page2').onclick = function() {

                document.querySelector('#myNavigator').pushPage('page2.html');
            };

        } else if (page.id === 'page2') {


            page.querySelector('#next-page3').onclick = function() {
            txt[0] = document.getElementById('yourtext0').value;
            txt[1] = document.getElementById('yourtext1').value;
            txt[2] = document.getElementById('yourtext2').value;
            txt[3] = document.getElementById('yourtext3').value;
                document.querySelector('#myNavigator').pushPage('page3.html');
            };

        } else if (page.id === 'page3') {



            page.querySelector('#next-page4').onclick = function() {

                document.querySelector('#myNavigator').pushPage('page4.html', {data: {title: 'เลือกตำแหน่ง'}});
            };
            page3draw();


            /* page2draw();
             page2clear();
             page2draw();
             page2clear();
             page2draw();
             page2clear();
             page2draw();*/


        } else if (page.id === 'page4') {
            page.querySelector('ons-toolbar .center').innerHTML = page.data.title;

            /* Initialize Firebase
             var config = {
             apiKey: "AIzaSyA83WDgXFYbIXc6wI0D6tpShrIhMW8teRQ",
             authDomain: "mysticker-f7d1e.firebaseapp.com",
             databaseURL: "https://mysticker-f7d1e.firebaseio.com",
             projectId: "mysticker-f7d1e",
             storageBucket: "mysticker-f7d1e.appspot.com",
             messagingSenderId: "342976982342"
             };
             firebase.initializeApp(config);
             */
            document.body._gestureDetector.dispose(); // Touch Enable
            imageData = $('.image-editor').cropit('export', {
                quality: 1
            });

            c = document.getElementById("cavasPIC");
            context_can = c.getContext("2d");
            image = new Image();
            image.onload = function() {
                context_can.drawImage(image, 0, 0);

            };
            image.src = imageData;
            setBorderCanvas("txtCanvas0",'red');
            setBorderCanvas("txtCanvas1",'blue');
            setBorderCanvas("txtCanvas2",'green');
            setBorderCanvas("txtCanvas3",'orange');
            drawText(txt[0],"txtCanvas0",txtColor[0],borderColor[0],txtSize[0],"Sriracha",0,0);
            drawText(txt[1],"txtCanvas1",txtColor[1],borderColor[1],txtSize[1],"Sriracha",0,0);
            drawText(txt[2],"txtCanvas2",txtColor[2],borderColor[2],txtSize[2],"Sriracha",0,0);
            drawText(txt[3],"txtCanvas3",txtColor[3],borderColor[3],txtSize[3],"Sriracha",0,0);


            page.querySelector('#next-page5').onclick = function() {

                document.querySelector('#myNavigator').pushPage('page5.html', {data: {title: 'พรีวิว'}});

            };

        } else if (page.id === 'page5') {
            page.querySelector('ons-toolbar .center').innerHTML = page.data.title;


            c = document.getElementById("canvasPV");
            context_can = c.getContext("2d");
            image = new Image();
            image.onload = function() {
                var margin_top = $(".toolbar").css("height");
                console.log("margin :"+margin_top);
                console.log("x : "+posX);
                console.log("y : "+posY);
                context_can.drawImage(image, 0, 0);
                drawText(txt[0],"canvasPV",txtColor[parseInt(num)],borderColor[parseInt(num)],txtSize[parseInt(num)],"Sriracha",posX,posY);

            };
            image.src = imageData;

/*            var w=window.open('about:blank','image from canvas');
            w.document.write("<img src='"+ c.toDataURL("image/png")+"' alt='from canvas'/>")*/
        }
    });

</script>
</body>
</html>